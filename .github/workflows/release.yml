name: Create Addon Release

on:
  push:
    tags:
      - 'v*'  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—É—à–µ –ª—é–±—ã—Ö —Ç–µ–≥–æ–≤ –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å 'v'

permissions:
  contents: write

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract version from tag
        id: get_version
        run: |
          # –£–±–∏—Ä–∞–µ–º 'v' –∏–∑ —Ç–µ–≥–∞ (v1.2.3 ‚Üí 1.2.3)
          VERSION="${GITHUB_REF#refs/tags/v}"
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "üì¶ Building version: $VERSION"

      - name: Create addon directory structure
        run: |
          # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–ª—è WoW
          mkdir -p AferistHelper
          cp AferistHelper.toc AferistHelper/
          cp AferistHelper.lua AferistHelper/
          cp MuteManager.lua AferistHelper/
          cp AferistHelper_Configs.lua AferistHelper/
          cp README.md AferistHelper/

      - name: Create ZIP archive
        run: |
          # –°–æ–∑–¥–∞–µ–º ZIP –∞—Ä—Ö–∏–≤ —Å –∏–º–µ–Ω–µ–º –ø–∞–ø–∫–∏ –∞–¥–¥–æ–Ω–∞
          zip -r "AferistHelper-${{ steps.get_version.outputs.version }}.zip" AferistHelper/
          echo "üìÅ Created: AferistHelper-${{ steps.get_version.outputs.version }}.zip"
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–∞
          echo "üìã Archive contents:"
          unzip -l "AferistHelper-${{ steps.get_version.outputs.version }}.zip"

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref }}
          release_name: AferistHelper ${{ steps.get_version.outputs.version }}
          body: |
            ## AferistHelper ${{ steps.get_version.outputs.version }}
            
            ### üì¶ Automatic Release
            
            **Installation:**
            1. Download the ZIP file
            2. Extract to `World of Warcraft/_classic_/Interface/AddOns/`
            3. Restart the game
            
            ### üìÅ Files included:
            - AferistHelper.toc
            - AferistHelper.lua
            - MuteManager.lua
            - AferistHelper_Configs.lua
            
            *Automatically generated release*
          files: |
            AferistHelper-${{ steps.get_version.outputs.version }}.zip
          generate_release_notes: true
